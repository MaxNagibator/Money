<EditForm Model="@Input"
          OnValidSubmit="SubmitAsync">
    <DataAnnotationsValidator />
    <MudDialog>
        <TitleContent>
            <MudText Typo="Typo.h6">
                @MudDialog.Title
            </MudText>
        </TitleContent>
        <DialogContent>
            <MudGrid>
                <MudItem md="12"
                         xs="12">
                    <MudTextField AdornmentColor="Color.Tertiary"
                                  AdornmentIcon="@Icons.Material.Rounded.Comment"
                                  AutoGrow
                                  @bind-Value="Input.Title"
                                  For="@(() => Input.Title)"
                                  HelperText="Что произошло"
                                  Label="Описание" />
                </MudItem>
                <MudItem md="12" xs="12">
                    <MudText Typo="Typo.subtitle1" Class="mb-2">Тип события</MudText>
                    <MudGrid Spacing="2">
                        @foreach (var eventType in CarEventTypes.Values.Values)
                        {
                            <MudItem xs="3">
                                <MudPaper Class="@($"pa-1 cursor-pointer {GetSelectedClass(eventType)}")"
                                    @onclick="@(() => SelectEventType(eventType))">
                                    <MudStack AlignItems="AlignItems.Center">
                                        <MudImage Src="@eventType.GetIcon()"
                                                  Height="64"
                                                  Width="64" />
                                        <MudText Align="Align.Center" Typo="Typo.body2">@eventType.Name</MudText>
                                    </MudStack>
                                </MudPaper>
                            </MudItem>
                        }
                    </MudGrid>
                    <ValidationMessage For="@(() => Input.Type)" />
                </MudItem>
                <MudItem md="6"
                         xs="12">
                    <MudDatePicker Adornment="Adornment.Start"
                                   AdornmentColor="Color.Tertiary"
                                   AnchorOrigin="Origin.BottomLeft"
                                   For="@(() => Input.Date)"
                                   @bind-Date="@Input.Date"
                                   Clearable
                                   Color="Color.Tertiary"
                                   DateFormat="dd.MM.yyyy"
                                   Editable
                                   Label="Дата"
                                   HelperText="Когда"
                                   Mask="@(new DateMask("dd.MM.yyyy"))" />
                </MudItem>
                <MudItem md="6"
                         xs="12">
                    <MudNumericField AdornmentColor="Color.Tertiary"
                                     @bind-Value="Input.Mileage"
                                     Clearable
                                     Immediate
                                     For="@(() => Input.Mileage)"
                                     HelperText="10000"
                                     Label="Пробег (км)" />
                </MudItem>

                <MudItem md="12"
                         xs="12">
                    <MudTextField AdornmentColor="Color.Tertiary"
                                  AdornmentIcon="@Icons.Material.Rounded.Comment"
                                  AutoGrow
                                  @bind-Value="Input.Comment"
                                  For="@(() => Input.Comment)"
                                  Label="Подробности" />
                </MudItem>
            </MudGrid>
        </DialogContent>
        <DialogActions>
            <MudButton OnClick="Cancel">Отмена</MudButton>
            <MudButton ButtonType="ButtonType.Submit"
                       Color="Color.Success"
                       Disabled="@_isProcessing">
                @if (_isProcessing)
                {
                    <MudProgressCircular Class="ms-n1"
                                         Indeterminate="true"
                                         Size="Size.Small" />
                }
                else
                {
                    <MudText Typo="Typo.button">Сохранить</MudText>
                }
            </MudButton>
        </DialogActions>
    </MudDialog>
</EditForm>

<style>
    .selected-event-type {
        border: 2px solid var(--mud-palette-primary);
        border-radius: 4px;
        background-color: var(--mud-palette-primary-lighten);
    }

    .cursor-pointer {
        cursor: pointer;
    }
</style>
